local ReplicatedStorage = game:GetService("ReplicatedStorage")

local UseItemEvent = ReplicatedStorage:WaitForChild("UseItemEvent")
local ItemData = require(ReplicatedStorage:WaitForChild("ItemDataModule"))

-- ğŸ” ä»®ã®ã‚µãƒ¼ãƒãƒ¼ç”¨Inventoryï¼ˆå°†æ¥çš„ã«ã¯DataStoreå¯¾å¿œãªã©ã‚‚ã‚¢ãƒªï¼‰
local ServerInventories = {}

-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå‚åŠ ã—ãŸã‚‰ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªåˆæœŸåŒ–
game.Players.PlayerAdded:Connect(function(player)
	ServerInventories[player.UserId] = {
		["HealthPotion"] = 2,
		["SpeedBoots"] = 1,
	}
end)

-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæŠœã‘ãŸã‚‰ç ´æ£„ï¼ˆãƒ¡ãƒ¢ãƒªç¯€ç´„ï¼‰
game.Players.PlayerRemoving:Connect(function(player)
	ServerInventories[player.UserId] = nil
end)

-- ğŸ¯ UseItemå—ä¿¡å‡¦ç†ï¼
UseItemEvent.OnServerEvent:Connect(function(player, itemName)
	local inventory = ServerInventories[player.UserId]
	if not inventory then return end

	local count = inventory[itemName]
	if count and count > 0 then
		local item = ItemData[itemName]
		if item and item.Effect then
			print(player.Name .. " ãŒ " .. itemName .. " ã‚’ä½¿ã£ãŸï¼")
			item.Effect(player) -- åŠ¹æœã‚’ç™ºå‹•ï¼

			inventory[itemName] -= 1 -- æ‰€æŒæ•°æ¸›ã‚‰ã™

			-- âš ï¸ UIæ›´æ–°ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€šçŸ¥ï¼‰ãŒå¿…è¦ã«ãªã‚‹ã‘ã©ã€ä»Šã¯å‰²æ„›ä¸­ï¼
		else
			warn("åŠ¹æœãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚¤ãƒ†ãƒ : " .. itemName)
		end
	else
		warn(player.Name .. " ã¯ " .. itemName .. " ã‚’æŒã£ã¦ã„ã¾ã›ã‚“ï¼")
	end
end)
